<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sublimaster | Pedido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .logo-placeholder {
            color: #666;
            font-size: 1.2em;
        }

        .logo-placeholder span {
            color: #764ba2;
            font-weight: bold;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .btn-generate-link {
            background: #ffc107;
            color: #333;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 20px;
            width: 100%;
        }

        .btn-generate-link:hover {
            background: #ffb300;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);
        }

        .link-result {
            display: none;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .link-result.show {
            display: block;
        }

        .link-url {
            background: white;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #667eea;
            margin: 10px 0;
            border: 1px solid #ddd;
        }

        .btn-copy-link {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            width: 100%;
            transition: background 0.3s;
        }

        .btn-copy-link:hover {
            background: #218838;
        }

        label {
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="tel"],
        input[type="email"] {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            height: 44px;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-upload-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .file-upload-section h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .file-upload-section p {
            color: #666;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .import-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .file-upload-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .file-upload-btn:hover {
            background: #0056b3;
        }

        .btn-template {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-template:hover {
            background: #5a6268;
        }

        .file-name {
            margin-top: 10px;
            color: #28a745;
            font-size: 14px;
            font-weight: 500;
        }

        .table-container {
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .input-row {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #667eea;
            color: white;
            padding: 14px 8px;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
        }

        td {
            padding: 8px 4px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        .col-tipo { width: 140px; }
        .col-nome { width: 200px; }
        .col-numero { width: 100px; }
        .col-adicional { width: 180px; }
        .col-tam-camiseta { width: 120px; }
        .col-tam-calcao { width: 120px; }
        .col-quantidade { width: 80px; }
        .col-acoes { width: 100px; }

        td input,
        td select {
            width: 100%;
            height: 38px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        td input:focus,
        td select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-add {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            height: 38px;
            width: 100%;
            transition: background 0.3s;
        }

        .btn-add:hover {
            background: #218838;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            height: 38px;
            width: 100%;
            transition: background 0.3s;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        .submit-section {
            margin-top: 30px;
            text-align: center;
        }

        .btn-submit {
            background: #667eea;
            color: white;
            padding: 15px 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-new {
            background: #28a745;
            color: white;
            padding: 15px 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 15px;
        }

        .btn-new:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            animation: slideDown 0.3s;
        }

        .modal-content h2 {
            color: #28a745;
            margin-bottom: 20px;
        }

        .modal-content p {
            margin-bottom: 20px;
            color: #555;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: #667eea;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #764ba2;
        }

        .modal-btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .modal-btn-secondary:hover {
            background: #e0e0e0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            table {
                font-size: 11px;
            }

            th, td {
                padding: 6px 2px;
            }

            .modal-content {
                margin: 50% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Sublimaster | Pedido</h1>
        
        <div class="logo-section">
            <div class="logo-placeholder">
                Sua<br>
                marca<br>
                <span>AQUI.</span>
            </div>
        </div>

        <form id="orderForm">
            <div class="form-grid">
                <div class="form-group">
                    <label>üìù Refer√™ncia do Pedido *</label>
                    <input type="text" id="referencia" placeholder="Ex: PED-2026-001" required>
                </div>

                <div class="form-group">
                    <label>üë§ Nome Completo *</label>
                    <input type="text" id="nome" placeholder="Digite o nome completo" required>
                </div>

                <div class="form-group">
                    <label>üì± Telefone *</label>
                    <input type="tel" id="telefone" placeholder="(00) 00000-0000" required>
                </div>

                <div class="form-group">
                    <label>üìß E-mail *</label>
                    <input type="email" id="email" placeholder="email@exemplo.com" required>
                </div>
            </div>

            <button type="button" class="btn-generate-link" onclick="gerarLink()">
                üîó Gerar Link para Cliente Preencher
            </button>

            <div id="linkResult" class="link-result">
                <strong>üìã Link gerado com sucesso!</strong>
                <div class="link-url" id="generatedLink"></div>
                <button type="button" class="btn-copy-link" onclick="copiarLinkGerado()">üìã Copiar Link</button>
            </div>

            <div class="file-upload-section">
                <h3>üìä Importar Planilha</h3>
                <p>Importe um arquivo CSV ou Excel com os itens do pedido</p>
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">
                <div class="import-buttons">
                    <button type="button" class="file-upload-btn" onclick="document.getElementById('fileInput').click()">
                        üìÅ Importar Planilha
                    </button>
                    <button type="button" class="btn-template" onclick="baixarTemplate()">
                        üì• Baixar Template
                    </button>
                </div>
                <div class="file-name" id="fileName"></div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="col-tipo">Tipo</th>
                            <th class="col-nome">Nome</th>
                            <th class="col-numero">N√∫mero</th>
                            <th class="col-adicional">Adicional</th>
                            <th class="col-tam-camiseta">Tam. Camiseta</th>
                            <th class="col-tam-calcao">Tam. Cal√ß√£o</th>
                            <th class="col-quantidade">Quant.</th>
                            <th class="col-acoes">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="itemsBody">
                        <tr class="input-row">
                            <td>
                                <select class="item-tipo">
                                    <option value="">Selecione</option>
                                    <option value="1 - Linha">1 - Linha</option>
                                    <option value="2 - Goleiro">2 - Goleiro</option>
                                    <option value="3 - Comiss√£o T√©cnica">3 - Comiss√£o T√©cnica</option>
                                    <option value="4 - Arbitragem">4 - Arbitragem</option>
                                    <option value="5 - Torcedor">5 - Torcedor</option>
                                    <option value="6 - Regata">6 - Regata</option>
                                    <option value="7 - Tradicional">7 - Tradicional</option>
                                    <option value="8 - Raglan">8 - Raglan</option>
                                    <option value="9 - Gola V">9 - Gola V</option>
                                    <option value="10 - Gola Polo">10 - Gola Polo</option>
                                </select>
                            </td>
                            <td><input type="text" class="item-nome" placeholder="Nome do jogador"></td>
                            <td><input type="text" class="item-numero" placeholder="N¬∫"></td>
                            <td><input type="text" class="item-adicional" placeholder="Ex: Capit√£o"></td>
                            <td>
                                <select class="item-tam-camiseta">
                                    <option value="">Selecione</option>
                                    <option value="PP">PP</option>
                                    <option value="P">P</option>
                                    <option value="M">M</option>
                                    <option value="G">G</option>
                                    <option value="GG">GG</option>
                                    <option value="G1">G1</option>
                                    <option value="G2">G2</option>
                                    <option value="G3">G3</option>
                                    <option value="G4">G4</option>
                                    <option value="G5">G5</option>
                                    <option value="BLPP">BLPP</option>
                                    <option value="BLP">BLP</option>
                                    <option value="BLM">BLM</option>
                                    <option value="BLG">BLG</option>
                                    <option value="BLGG">BLGG</option>
                                    <option value="BLG1">BLG1</option>
                                    <option value="BLG2">BLG2</option>
                                    <option value="BLG3">BLG3</option>
                                    <option value="BLG4">BLG4</option>
                                    <option value="BLG5">BLG5</option>
                                    <option value="1A">1A</option>
                                    <option value="2A">2A</option>
                                    <option value="4A">4A</option>
                                    <option value="6A">6A</option>
                                    <option value="8A">8A</option>
                                    <option value="10A">10A</option>
                                    <option value="12A">12A</option>
                                </select>
                            </td>
                            <td>
                                <select class="item-tam-calcao">
                                    <option value="">Selecione</option>
                                    <option value="PP">PP</option>
                                    <option value="P">P</option>
                                    <option value="M">M</option>
                                    <option value="G">G</option>
                                    <option value="GG">GG</option>
                                    <option value="G1">G1</option>
                                    <option value="G2">G2</option>
                                    <option value="G3">G3</option>
                                    <option value="G4">G4</option>
                                    <option value="G5">G5</option>
                                    <option value="BLPP">BLPP</option>
                                    <option value="BLP">BLP</option>
                                    <option value="BLM">BLM</option>
                                    <option value="BLG">BLG</option>
                                    <option value="BLGG">BLGG</option>
                                    <option value="BLG1">BLG1</option>
                                    <option value="BLG2">BLG2</option>
                                    <option value="BLG3">BLG3</option>
                                    <option value="BLG4">BLG4</option>
                                    <option value="BLG5">BLG5</option>
                                    <option value="1A">1A</option>
                                    <option value="2A">2A</option>
                                    <option value="4A">4A</option>
                                    <option value="6A">6A</option>
                                    <option value="8A">8A</option>
                                    <option value="10A">10A</option>
                                    <option value="12A">12A</option>
                                </select>
                            </td>
                            <td><input type="number" class="item-quantidade" value="1" min="1"></td>
                            <td>
                                <button type="button" class="btn-add" onclick="adicionarLinha()">Adicionar</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="submit-section">
                <button type="button" class="btn-new" onclick="novoPedido()">üîÑ Novo Pedido</button>
                <button type="submit" class="btn-submit">üì§ Enviar Pedido</button>
            </div>
        </form>
    </div>

    <div id="successModal" class="modal">
        <div class="modal-content">
            <h2>‚úÖ Pedido Enviado com Sucesso!</h2>
            <p id="modalMessage">Planilha criada com sucesso!</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="btnFecharModal">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwnjScm9c2iHeLjIpqh3NBJEjLnbPNyG9lb2qCvcUjIOh0GJ0lGLbPmKQj4tlvy0R8k/exec';
        
        // ============ CARREGA PAR√ÇMETROS DA URL ============
        function carregarParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            const referencia = urlParams.get('ref') || urlParams.get('referencia');
            const nome = urlParams.get('nome') || urlParams.get('name');
            const telefone = urlParams.get('tel') || urlParams.get('telefone') || urlParams.get('phone');
            const email = urlParams.get('email') || urlParams.get('mail');
            
            // ‚úÖ Se veio por link (tem par√¢metros), ESCONDE o bot√£o de gerar link
            const temParametros = referencia || nome || telefone;
            
            if (temParametros) {
                const btnGerarLink = document.querySelector('.btn-generate-link');
                const linkResult = document.getElementById('linkResult');
                
                if (btnGerarLink) btnGerarLink.style.display = 'none';
                if (linkResult) linkResult.style.display = 'none';
                
                console.log('üë§ Modo Cliente: Bot√£o de gerar link escondido');
            }
            
            if (referencia) {
                document.getElementById('referencia').value = referencia;
                document.getElementById('referencia').readOnly = true;
                document.getElementById('referencia').style.backgroundColor = '#f0f0f0';
            }
            
            if (nome) {
                document.getElementById('nome').value = decodeURIComponent(nome);
                document.getElementById('nome').readOnly = true;
                document.getElementById('nome').style.backgroundColor = '#f0f0f0';
            }
            
            if (telefone) {
                document.getElementById('telefone').value = telefone;
                document.getElementById('telefone').readOnly = true;
                document.getElementById('telefone').style.backgroundColor = '#f0f0f0';
            }
            
            if (email) {
                document.getElementById('email').value = decodeURIComponent(email);
                document.getElementById('email').readOnly = true;
                document.getElementById('email').style.backgroundColor = '#f0f0f0';
            }
        }
        
        // Carrega os par√¢metros quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', carregarParametrosURL);
        // ============ FIM DO CARREGAMENTO DE PAR√ÇMETROS ============
        
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                value = value.replace(/(\d)(\d{4})$/, '$1-$2');
            }
            e.target.value = value;
        });

        function adicionarLinha() {
            const tbody = document.getElementById('itemsBody');
            const primeiraLinha = tbody.rows[0];
            const tipoSelecionado = primeiraLinha.querySelector('.item-tipo').value;
            
            if (!tipoSelecionado) {
                alert('‚ö†Ô∏è Preencha o TIPO antes de adicionar!');
                primeiraLinha.querySelector('.item-tipo').focus();
                return;
            }
            
            const linhaPreenchida = primeiraLinha.cloneNode(true);
            linhaPreenchida.classList.remove('input-row');
            
            linhaPreenchida.querySelector('.item-tipo').value = primeiraLinha.querySelector('.item-tipo').value;
            linhaPreenchida.querySelector('.item-tam-camiseta').value = primeiraLinha.querySelector('.item-tam-camiseta').value;
            linhaPreenchida.querySelector('.item-tam-calcao').value = primeiraLinha.querySelector('.item-tam-calcao').value;
            linhaPreenchida.querySelector('.item-nome').value = primeiraLinha.querySelector('.item-nome').value;
            linhaPreenchida.querySelector('.item-numero').value = primeiraLinha.querySelector('.item-numero').value;
            linhaPreenchida.querySelector('.item-adicional').value = primeiraLinha.querySelector('.item-adicional').value;
            linhaPreenchida.querySelector('.item-quantidade').value = primeiraLinha.querySelector('.item-quantidade').value;
            
            const actionCell = linhaPreenchida.cells[linhaPreenchida.cells.length - 1];
            actionCell.innerHTML = '<button type="button" class="btn-remove" onclick="removerLinha(this)">Remover</button>';
            
            tbody.appendChild(linhaPreenchida);
            
            const tipoAtual = primeiraLinha.querySelector('.item-tipo').value;
            primeiraLinha.querySelectorAll('input').forEach(input => {
                input.classList.contains('item-quantidade') ? input.value = '1' : input.value = '';
            });
            primeiraLinha.querySelectorAll('select').forEach(select => {
                if (!select.classList.contains('item-tipo')) {
                    select.selectedIndex = 0;
                }
            });
            
            primeiraLinha.querySelector('.item-nome').focus();
        }

        function removerLinha(btn) {
            const row = btn.closest('tr');
            const tbody = document.getElementById('itemsBody');
            if (tbody.rows.length <= 1) {
                alert('‚ö†Ô∏è N√£o √© poss√≠vel remover a linha de entrada!');
                return;
            }
            row.remove();
        }

        function novoPedido() {
            if (confirm('üîÑ Iniciar novo pedido?\n\nIsso vai limpar todos os dados do formul√°rio atual.')) {
                document.getElementById('orderForm').reset();
                const tbody = document.getElementById('itemsBody');
                while (tbody.rows.length > 1) tbody.deleteRow(1);
                document.getElementById('fileName').textContent = '';
                document.getElementById('referencia').focus();
            }
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            document.getElementById('fileName').textContent = `‚è≥ Processando: ${file.name}`;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const text = event.target.result;
                    const linhas = text.split('\n').filter(linha => linha.trim());
                    const dadosLinhas = linhas.slice(1);
                    
                    if (dadosLinhas.length === 0) {
                        alert('‚ö†Ô∏è Arquivo vazio ou sem dados!');
                        return;
                    }
                    
                    const tbody = document.getElementById('itemsBody');
                    let itensImportados = 0;
                    
                    dadosLinhas.forEach(linha => {
                        const colunas = linha.split(',').map(col => col.trim().replace(/^"|"$/g, ''));
                        
                        if (colunas.length >= 7 && colunas[0]) {
                            const novaLinha = tbody.rows[0].cloneNode(true);
                            
                            novaLinha.querySelector('.item-tipo').value = colunas[0] || '';
                            novaLinha.querySelector('.item-nome').value = colunas[1] || '';
                            novaLinha.querySelector('.item-numero').value = colunas[2] || '';
                            novaLinha.querySelector('.item-adicional').value = colunas[3] || '';
                            novaLinha.querySelector('.item-tam-camiseta').value = colunas[4] || '';
                            novaLinha.querySelector('.item-tam-calcao').value = colunas[5] || '';
                            novaLinha.querySelector('.item-quantidade').value = colunas[6] || '1';
                            
                            const actionCell = novaLinha.cells[novaLinha.cells.length - 1];
                            actionCell.innerHTML = '<button type="button" class="btn-remove" onclick="removerLinha(this)">Remover</button>';
                            
                            tbody.appendChild(novaLinha);
                            itensImportados++;
                        }
                    });
                    
                    document.getElementById('fileName').textContent = `‚úÖ ${itensImportados} itens importados de: ${file.name}`;
                    
                } catch (error) {
                    alert('‚ùå Erro ao processar arquivo: ' + error.message);
                    document.getElementById('fileName').textContent = '';
                }
            };
            
            reader.readAsText(file);
        });

        function baixarTemplate() {
            const csvContent = "Tipo,Nome,N√∫mero,Adicional,Tam. Camiseta,Tam. Cal√ß√£o,Quantidade\n1 - Linha,Jos√© Silva,10,Capit√£o,M,M,1";
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template_pedido.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                referencia: document.getElementById('referencia').value,
                nome: document.getElementById('nome').value,
                telefone: document.getElementById('telefone').value,
                email: document.getElementById('email').value,
                itens: []
            };
            
            const rows = document.querySelectorAll('#itemsBody tr');
            
            rows.forEach((row, index) => {
                if (index === 0) return;
                
                const tipoValue = row.querySelector('.item-tipo').value;
                const item = {
                    tipo: tipoValue,
                    nome: row.querySelector('.item-nome').value,
                    numero: row.querySelector('.item-numero').value,
                    adicional: row.querySelector('.item-adicional').value,
                    tamCamiseta: row.querySelector('.item-tam-camiseta').value,
                    tamCalcao: row.querySelector('.item-tam-calcao').value,
                    quantidade: row.querySelector('.item-quantidade').value
                };
                
                if (item.tipo && item.tipo.trim() !== '') {
                    formData.itens.push(item);
                }
            });

            console.log('üîç DEBUG: Total de linhas na tabela:', rows.length);
            console.log('üì¶ Itens coletados:', formData.itens.length);
            console.log('üìã Dados finais:', formData);

            if (formData.itens.length === 0) {
                alert('‚ö†Ô∏è Nenhum item para enviar!\n\nPreencha pelo menos uma linha com o TIPO selecionado.');
                return;
            }
            
            const btnSubmit = document.querySelector('.btn-submit');
            const textoOriginal = btnSubmit.textContent;
            btnSubmit.disabled = true;
            btnSubmit.textContent = '‚è≥ Enviando...';
            
            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => {
                document.getElementById('modalMessage').innerHTML = 
                    `<strong>üìã Refer√™ncia:</strong> ${formData.referencia}<br>` +
                    `<strong>üë§ Cliente:</strong> ${formData.nome}<br>` +
                    `<strong>üì¶ Itens Enviados:</strong> ${formData.itens.length}<br><br>` +
                    `<em>Planilha atualizada com sucesso!</em>`;
                document.getElementById('successModal').style.display = 'block';
                
                console.log('‚úÖ Pedido enviado com sucesso!');
            })
            .catch(error => {
                alert('‚ùå Erro: ' + error.message);
                console.error('Erro:', error);
            })
            .finally(() => {
                btnSubmit.disabled = false;
                btnSubmit.textContent = textoOriginal;
            });
        });

        document.getElementById('btnFecharModal').addEventListener('click', function() {
            document.getElementById('successModal').style.display = 'none';
        });

        window.onclick = function(event) {
            const modal = document.getElementById('successModal');
            if (event.target == modal) modal.style.display = 'none';
        }

        // ============ GERAR LINK PARA CLIENTE ============
        function gerarLink() {
            const referencia = document.getElementById('referencia').value.trim();
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();

            if (!referencia || !nome || !telefone) {
                alert('‚ö†Ô∏è Preencha Refer√™ncia, Nome e Telefone para gerar o link!');
                return;
            }

            const urlAtual = window.location.href.split('?')[0];
            const params = new URLSearchParams({
                ref: referencia,
                nome: nome,
                tel: telefone.replace(/\D/g, '')
            });

            const linkCompleto = `${urlAtual}?${params.toString()}`;

            document.getElementById('generatedLink').textContent = linkCompleto;
            document.getElementById('linkResult').classList.add('show');

            document.getElementById('linkResult').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest' 
            });
        }

        function copiarLinkGerado() {
            const link = document.getElementById('generatedLink').textContent;
            
            navigator.clipboard.writeText(link).then(function() {
                const btn = document.querySelector('.btn-copy-link');
                const textoOriginal = btn.textContent;
                
                btn.textContent = '‚úÖ Link Copiado!';
                btn.style.background = '#1e7e34';
                
                setTimeout(function() {
                    btn.textContent = textoOriginal;
                    btn.style.background = '#28a745';
                }, 3000);
            }).catch(function(err) {
                alert('‚ùå Erro ao copiar: ' + err);
            });
        }
        // ============ FIM GERAR LINK ============
    </script>
</body>
</html>
