<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sublimaster | Pedido</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 15px;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
}

.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

.header h1 {
    font-size: 1.8em;
    margin-bottom: 10px;
}

.header p {
    font-size: 1em;
    opacity: 0.9;
}

.tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 3px solid #e9ecef;
}

.tab {
    flex: 1;
    padding: 18px;
    text-align: center;
    cursor: pointer;
    background: #f8f9fa;
    border: none;
    font-size: 15px;
    font-weight: 600;
    color: #666;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
    margin-bottom: -3px;
}

.tab:hover {
    background: #e9ecef;
}

.tab.active {
    background: white;
    color: #667eea;
    border-bottom-color: #667eea;
}

.tab-content {
    display: none;
    padding: 30px;
}

.tab-content.active {
    display: block;
}

.footer-1 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px 30px;
    text-align: center;
}

.footer-1 p {
    margin: 3px 0;
    font-size: 13px;
    opacity: 0.9;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    color: #333;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 14px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.form-group input:disabled,
.form-group select:disabled {
    background-color: #f0f0f0;
    cursor: not-allowed;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.accordion-item {
    border: 1px solid #e9ecef;
    border-radius: 6px;
    margin-bottom: 4px;
    overflow: hidden;
    transition: all 0.3s;
}

.accordion-item:hover {
    border-color: #667eea;
}

.accordion-item.enviado {
    background: #d4edda;
    border-color: #28a745;
}

.accordion-header {
    background: #f8f9fa;
    padding: 6px 10px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    color: #333;
    user-select: none;
    font-size: 12px;
    line-height: 1.2;
}

.accordion-item.enviado .accordion-header {
    background: #d4edda;
}

.accordion-header:hover {
    background: #e9ecef;
}

.accordion-header.active {
    background: #667eea;
    color: white;
}

.accordion-icon {
    transition: transform 0.3s;
    font-size: 0.9em;
}

.accordion-header.active .accordion-icon {
    transform: rotate(180deg);
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: white;
}

.accordion-content.active {
    max-height: 1000px;
}

.accordion-body {
    padding: 15px;
}

.item-summary {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    font-size: 13px;
    color: #666;
    margin-bottom: 15px;
}

.item-summary span {
    background: #e9ecef;
    padding: 4px 10px;
    border-radius: 5px;
}

.item-edit-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.item-edit-field {
    display: flex;
    flex-direction: column;
}

.item-edit-field label {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
    font-weight: 600;
}

.item-edit-field input,
.item-edit-field select {
    padding: 8px 10px;
    border: 1px solid #d2d2d7;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s;
}

.item-edit-field input:focus,
.item-edit-field select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ESTILOS PARA REVIS√ÉO - COMPACTOS */
.item-review {
    margin-bottom: 6px;
    padding: 8px 12px;
    background: #f8f9fa;
    border-radius: 4px;
    border: 1px solid #e9ecef;
    text-align: left;
}

.item-header {
    font-size: 14px; 
    font-weight: 600;
    color: #667eea;
    margin-bottom: 4px;
    line-height: 1.3;
    text-align: left;
}

.item-details {
    font-size: 12px;
    color: #555;
    line-height: 1.4;
    padding-left: 0px;
    text-align: left;
    font-weight: 600;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary {
    background: #667eea;
    color: white;
    width: 100%;
    padding: 15px;
    font-size: 16px;
}

.btn-primary:hover {
    background: #764ba2;
    transform: translateY(-2px);
}

.btn-primary:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

.btn-add {
    background: #28a745;
    color: white;
    width: 100%;
    margin-top: 15px;
}

.btn-add:hover {
    background: #218838;
}

.btn-remove {
    background: #dc3545;
    color: white;
    width: 100%;
    margin-top: 10px;
}

.btn-remove:hover {
    background: #c82333;
}

.btn-link {
    background: #ffc107;
    color: #333;
    width: 100%;
    margin-top: 15px;
}

.btn-link:hover {
    background: #ffb300;
}

.new-item-box {
    background: linear-gradient(135deg, #fff3cd 0%, #fff9e6 100%);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
}

.new-item-box h3 {
    color: #856404;
    margin-bottom: 10px;
    font-size: 1em;
}

.new-item-box .form-group {
    margin-bottom: 12px;
}

.new-item-box .form-grid {
    gap: 10px;
}

.new-item-box input,
.new-item-box select {
    padding: 10px;
}

.items-list {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 5px;
}

.counter-badge {
    background: #667eea;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 8px;
}

.link-result {
    display: none;
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
}

.link-result.show {
    display: block;
}

.link-url {
    background: white;
    padding: 10px;
    border-radius: 4px;
    word-break: break-all;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    color: #667eea;
    margin: 10px 0;
    border: 1px solid #ddd;
}

.btn-copy-link {
    background: #28a745;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    width: 100%;
    transition: background 0.3s;
}

.btn-copy-link:hover {
    background: #218838;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s;
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    text-align: center;
    animation: slideDown 0.3s;
}

.modal-content h2 {
    color: #28a745;
    margin-bottom: 20px;
}

.modal-content p {
    margin-bottom: 20px;
    color: #555;
    line-height: 1.6;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}

.modal-btn-primary {
    background: #667eea;
    color: white;
}

.modal-btn-primary:hover {
    background: #764ba2;
}

.modal-btn-secondary {
    background: #f0f0f0;
    color: #333;
}

.modal-btn-secondary:hover {
    background: #e0e0e0;
}

.badge-enviado {
    background: #28a745;
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    margin-left: 10px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

@media (max-width: 600px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    .item-edit-grid {
        grid-template-columns: 1fr;
    }
    .tab {
        font-size: 13px;
        padding: 15px 10px;
    }
    .header {
        padding: 20px;
    }
    .header h1 {
        font-size: 1.4em;
    }
    .tab-content {
        padding: 20px;
    }
    .btn-group {
        grid-template-columns: 1fr;
    }
}

/* ========== BOT√ïES LADO A LADO NO DESKTOP ========== */
.btn-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 25px;
}

.btn-print {
    background: #28a745;
    color: white;
    width: 100%;
    padding: 15px;
    font-size: 16px;
}

.btn-print:hover {
    background: #218838;
    transform: translateY(-2px);
}

/* ========== ESTILOS PARA IMPRESS√ÉO ========== */
.print-only {
    display: none;
}

@media print {
    body {
        background: white;
        padding: 0;
    }

    .container {
        box-shadow: none;
        border-radius: 0;
        max-width: 100%;
    }

    .header {
        background: white !important;
        color: #333 !important;
        border-bottom: 2px solid #333;
    }

    .tabs,
    .btn-group,
    .footer-1,
    .no-print {
        display: none !important;
    }

    .tab-content {
        display: block !important;
        padding: 20px;
    }

    .tab-content:not(#revisar) {
        display: none !important;
    }

    .item-review {
        background: white;
        border: 1px solid #ddd;
        page-break-inside: avoid;
    }

    .print-only {
        display: block !important;
        text-align: center;
        padding: 20px 0;
        border-top: 2px solid #ddd;
        margin-top: 30px;
        font-size: 12px;
        color: #666;
    }

    h1, h2, h3 {
        color: #333 !important;
    }
}
        .btn-historico {
    position: absolute;
    top: 30px;
    right: 30px;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 10px 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-historico:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Modal Hist√≥rico */
.modal-historico {
    background: white;
    margin: 3% auto;
    padding: 0;
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    animation: slideDown 0.3s;
}

.modal-historico-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px 30px;
    border-radius: 12px 12px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-historico-header h2 {
    margin: 0;
    font-size: 1.5em;
}

.btn-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.btn-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.modal-historico-busca {
    padding: 20px 30px;
    border-bottom: 1px solid #e9ecef;
}

.search-box {
    position: relative;
}

.search-box input {
    width: 100%;
    padding: 12px 40px 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.search-box input:focus {
    outline: none;
    border-color: #667eea;
}

.search-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
}

.modal-historico-body {
    padding: 20px 30px;
    overflow-y: auto;
    flex: 1;
}

/* Cards de Pedidos */
.pedido-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
}

.pedido-card:hover {
    border-color: #667eea;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
}

.pedido-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.pedido-ref {
    font-size: 16px;
    font-weight: 600;
    color: #667eea;
}

.pedido-data {
    font-size: 12px;
    color: #999;
}

.pedido-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 12px;
    font-size: 13px;
    color: #555;
}

.pedido-info-item {
    display: flex;
    gap: 5px;
}

.pedido-info-label {
    font-weight: 600;
}

.pedido-actions {
    display: flex;
    gap: 10px;
}

.btn-action {
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-ver {
    background: #667eea;
    color: white;
}

.btn-ver:hover {
    background: #764ba2;
}

.btn-voltar {
    background: #6c757d;
    color: white;
}

.btn-voltar:hover {
    background: #5a6268;
}

/* Views do Modal */
.view-lista {
    display: block;
}

.view-detalhes {
    display: none;
}

/* Detalhes do Pedido */
.detalhes-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.detalhes-header h3 {
    font-size: 1.3em;
    margin-bottom: 8px;
}

.detalhes-header p {
    font-size: 13px;
    opacity: 0.9;
}

.detalhes-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
}

.detalhes-section h4 {
    color: #667eea;
    font-size: 1.1em;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.info-row {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.info-row.full-width {
    grid-column: 1 / -1;
}

.info-label {
    font-size: 12px;
    color: #999;
    font-weight: 600;
    text-transform: uppercase;
}

.info-value {
    font-size: 14px;
    color: #333;
    font-weight: 500;
}

/* Tabela de Itens */
.itens-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.itens-table thead {
    background: #667eea;
    color: white;
}

.itens-table th {
    padding: 12px 10px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
}

.itens-table tbody tr {
    border-bottom: 1px solid #e9ecef;
}

.itens-table tbody tr:hover {
    background: #f1f3f5;
}

.itens-table td {
    padding: 10px;
    font-size: 13px;
    color: #555;
}

.item-tipo {
    font-weight: 600;
    color: #667eea;
}

.item-tamanho {
    display: inline-block;
    background: #e9ecef;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
}

.detalhes-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.empty-state-historico {
    text-align: center;
    padding: 60px 20px;
    color: #999;
}

.empty-state-historico-icon {
    font-size: 4em;
    margin-bottom: 15px;
    opacity: 0.3;
}

.loading-historico {
    text-align: center;
    padding: 40px;
    color: #667eea;
}

.loading-spinner-historico {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

/* Responsive */
@media (max-width: 768px) {
    .modal-historico {
        margin: 0;
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
    }

    .modal-historico-header {
        border-radius: 0;
    }

    .pedido-info,
    .info-grid {
        grid-template-columns: 1fr;
    }

    .btn-historico {
        position: static;
        display: block;
        margin-top: 15px;
        width: 100%;
    }

    .itens-table {
        font-size: 12px;
    }

    .itens-table th,
    .itens-table td {
        padding: 8px 5px;
    }
}
    </style>
</head>
<body>
    <!-- MODAL DE SENHA ADMIN -->
    <div id="senhaModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 style="color: #667eea;">üîê Acesso Administrativo</h2>
            <p style="margin-bottom: 20px;">Digite a senha para acessar o sistema:</p>
            <div class="form-group">
                <input type="password" id="senhaAdmin" placeholder="Digite a senha" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; text-align: center;">
            </div>
            <div style="color: #dc3545; font-size: 13px; margin-top: 10px; min-height: 20px;" id="senhaErro"></div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="modal-btn modal-btn-primary" onclick="validarSenha()">üîì Acessar</button>
            </div>
            <p style="margin-top: 15px; font-size: 12px; color: #999;">¬© 2026 Sublimaster - Sistema de Pedidos</p>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
    <h1>üìã Sublimaster | Pedido</h1>
    <p>Crie seu pedido em 3 passos</p>
    
    <!-- ===== NOVO: Bot√£o Hist√≥rico ===== -->
    <button class="btn-historico" onclick="abrirHistorico()">üìä Hist√≥rico</button>
    <!-- ================================== -->
</div>

        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'dados')">
                üìù Dados
            </button>
            <button class="tab" onclick="openTab(event, 'itens')">
                üì¶ Itens <span class="counter-badge" id="counterBadge">0</span>
            </button>
            <button class="tab" onclick="openTab(event, 'revisar')">
                ‚úÖ Revisar
            </button>
        </div>

        <div id="dados" class="tab-content active">
            <h2 style="color: #667eea; margin-bottom: 20px;">Informa√ß√µes do Pedido</h2>
            
            <div class="form-group">
                <label>üìù Refer√™ncia do Pedido *</label>
                <input type="text" id="referencia" placeholder="Ex: PED-2026-001" required>
            </div>

            <div class="form-group">
                <label>üë§ Nome Completo *</label>
                <input type="text" id="nome" placeholder="Digite o nome completo" required>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label>üì± Telefone *</label>
                    <input type="tel" id="telefone" placeholder="(00) 00000-0000" required>
                </div>
                <div class="form-group">
                    <label>üìß E-mail</label>
                    <input type="email" id="email" placeholder="email@exemplo.com">
                </div>
            </div>

            <button class="btn btn-link" onclick="gerarLink()">üîó Gerar Link para Cliente</button>

            <div id="linkResult" class="link-result">
                <strong>üìã Link gerado com sucesso!</strong>
                <div class="link-url" id="generatedLink"></div>
                <button type="button" class="btn-copy-link" onclick="copiarLinkGerado()">üìã Copiar Link</button>
            </div>
        </div>

        <div id="itens" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">Gerenciar Itens</h2>

            <div class="new-item-box">
    <h3>‚ûï Adicionar Novo Item</h3>
    
    <div class="form-group">
        <label>Tipo *</label>
        <select id="novoTipo">
            <option value="">Selecione o tipo</option>
            <option value="1 - Linha">1 - Linha</option>
            <option value="2 - Goleiro">2 - Goleiro</option>
            <option value="3 - Comiss√£o T√©cnica">3 - Comiss√£o T√©cnica</option>
            <option value="4 - Arbitragem">4 - Arbitragem</option>
            <option value="5 - Torcedor">5 - Torcedor</option>
            <option value="6 - Regata">6 - Regata</option>
            <option value="7 - Tradicional">7 - Tradicional</option>
            <option value="8 - Raglan">8 - Raglan</option>
            <option value="9 - Gola V">9 - Gola V</option>
            <option value="10 - Gola Polo">10 - Gola Polo</option>
        </select>
    </div>

    <div class="form-grid">
        <div class="form-group">
            <label>Nome</label>
            <input type="text" id="novoNome" placeholder="Nome do jogador">
        </div>
        <div class="form-group">
            <label>N√∫mero</label>
            <input type="text" id="novoNumero" placeholder="N¬∫">
        </div>
    </div>

    <div class="form-group">
        <label>Adicional</label>
        <input type="text" id="novoAdicional" placeholder="Ex: Capit√£o">
    </div>

    <div class="form-grid">
        <div class="form-group">
            <label>Tamanho Camiseta * </label>
            <select id="novoTamCamiseta">
                <option value="">Selecione</option>
                <option value="PP">PP</option>
                <option value="P">P</option>
                <option value="M">M</option>
                <option value="G">G</option>
                <option value="GG">GG</option>
                <option value="G1">G1</option>
                <option value="G2">G2</option>
                <option value="G3">G3</option>
                <option value="G4">G4</option>
                <option value="G5">G5</option>
                <option value="BLPP">BLPP</option>
                <option value="BLP">BLP</option>
                <option value="BLM">BLM</option>
                <option value="BLG">BLG</option>
                <option value="BLGG">BLGG</option>
                <option value="BLG1">BLG1</option>
                <option value="BLG2">BLG2</option>
                <option value="BLG3">BLG3</option>
                <option value="BLG4">BLG4</option>
                <option value="BLG5">BLG5</option>
                <option value="1A">1A</option>
                <option value="2A">2A</option>
                <option value="4A">4A</option>
                <option value="6A">6A</option>
                <option value="8A">8A</option>
                <option value="10A">10A</option>
                <option value="12A">12A</option>
            </select>
        </div>
        <div class="form-group">
            <label>Tamanho Cal√ß√£o * </label>
            <select id="novoTamCalcao">
                <option value="">Selecione</option>
                <option value="PP">PP</option>
                <option value="P">P</option>
                <option value="M">M</option>
                <option value="G">G</option>
                <option value="GG">GG</option>
                <option value="G1">G1</option>
                <option value="G2">G2</option>
                <option value="G3">G3</option>
                <option value="G4">G4</option>
                <option value="G5">G5</option>
                <option value="BLPP">BLPP</option>
                <option value="BLP">BLP</option>
                <option value="BLM">BLM</option>
                <option value="BLG">BLG</option>
                <option value="BLGG">BLGG</option>
                <option value="BLG1">BLG1</option>
                <option value="BLG2">BLG2</option>
                <option value="BLG3">BLG3</option>
                <option value="BLG4">BLG4</option>
                <option value="BLG5">BLG5</option>
                <option value="1A">1A</option>
                <option value="2A">2A</option>
                <option value="4A">4A</option>
                <option value="6A">6A</option>
                <option value="8A">8A</option>
                <option value="10A">10A</option>
                <option value="12A">12A</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>Quantidade *</label>
        <input type="number" id="novoQuantidade" value="1" min="1">
    </div>

    <button class="btn btn-add" onclick="adicionarItem()">‚úÖ Adicionar √† Lista</button>
</div>

            <h3 style="color: #333; margin: 25px 0 15px 0;">üìã Itens Adicionados</h3>

            <div class="items-list" id="itemsList">
                <div class="empty-state" style="text-align: center; padding: 40px 20px; color: #999;">
                    <div style="font-size: 3em; margin-bottom: 10px;">üì¶</div>
                    <p>Nenhum item adicionado ainda</p>
                </div>
            </div>
        </div>

        <div id="revisar" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">Revis√£o Final</h2>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #333; margin-bottom: 15px;">üìù Dados do Pedido</h3>
                <p><strong>Refer√™ncia:</strong> <span id="reviewRef">-</span></p>
                <p><strong>Cliente:</strong> <span id="reviewNome">-</span></p>
                <p><strong>Telefone:</strong> <span id="reviewTel">-</span></p>
                <p><strong>E-mail:</strong> <span id="reviewEmail">-</span></p>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                <h3 style="color: #333; margin-bottom: 15px;">üì¶ Itens do Pedido</h3>
                <p><strong>Total de itens:</strong> <span id="reviewTotal">0</span></p>
                <ul id="reviewList" style="list-style: none; padding: 0; margin-top: 15px; font-size: 14px; color: #666; line-height: 1.8;">
                </ul>
            </div>

          <div class="print-only">
                <p>Impresso em: <span id="printDate"></span></p>
            </div>

            <div class="btn-group no-print">
                <button class="btn btn-primary" onclick="enviarPedido()">üì§ Enviar Pedido</button>
                <button class="btn btn-print" onclick="imprimirPedido()">üñ®Ô∏è Imprimir Pedido</button>
            </div>
        </div>
        
        <div class="footer-1">
            <p>¬© 2026 Sublimaster - Sistema de Pedidos</p>
            <p style="font-size: 12px; opacity: 0.8;">Todos os direitos reservados</p>
        </div>
        
    </div>

    <!-- MODAIS -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <h2>‚úÖ Pedido Enviado com Sucesso!</h2>
            <p id="modalMessage">Planilha criada com sucesso!</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="btnFecharModal">Fechar</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #dc3545;">üóëÔ∏è Confirmar Dele√ß√£o</h2>
            <p id="deleteMessage"></p>
            <div class="modal-buttons">
                <button class="modal-btn" style="background: #dc3545; color: white;" id="btnConfirmarDelete">
                    üóëÔ∏è Sim, Deletar
                </button>
                <button class="modal-btn modal-btn-secondary" id="btnCancelarDelete">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="duplicataModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #ffc107;">‚ö†Ô∏è Item Duplicado Detectado!</h2>
            <p style="font-size: 15px; color: #666;">
                <strong>Este item J√Å EXISTE na lista com os mesmos dados:</strong>
            </p>
            <div id="duplicataDetalhes" class="item-details"></div>
            <p style="font-size: 14px; margin-top: 15px;">
                Deseja <strong>adicionar mesmo assim</strong>?
            </p>
            <div class="modal-buttons">
                <button class="modal-btn" style="background: #28a745; color: white;" id="btnConfirmarDuplicata">
                    ‚úÖ Sim, Adicionar
                </button>
                <button class="modal-btn modal-btn-secondary" id="btnCancelarDuplicata">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="modalHistorico" class="modal">
    <div class="modal-historico">
        <div class="modal-historico-header">
            <h2 id="modalTitulo">üìä Hist√≥rico de Pedidos</h2>
            <button class="btn-close" onclick="fecharHistorico()">√ó</button>
        </div>

        <div class="modal-historico-busca" id="buscaArea">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Buscar por refer√™ncia, cliente ou telefone..." oninput="buscarPedidosLocal()">
                <span class="search-icon">üîç</span>
            </div>
        </div>

        <div class="modal-historico-body" id="listaPedidos">
            <!-- VIEW LISTA -->
            <div id="viewLista" class="view-lista">
                <!-- Loading inicial -->
                <div class="loading-historico" id="loadingLista">
                    <div class="loading-spinner-historico"></div>
                    <p>Carregando pedidos...</p>
                </div>

                <!-- Container dos cards (preenchido dinamicamente) -->
                <div id="cardsContainer"></div>

                <!-- Estado vazio (quando n√£o h√° pedidos) -->
                <div class="empty-state-historico" id="emptyState" style="display: none;">
                    <div class="empty-state-historico-icon">üìã</div>
                    <p style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">Nenhum pedido encontrado</p>
                    <p style="font-size: 14px;">Tente buscar com outros termos ou crie seu primeiro pedido</p>
                </div>
            </div>

            <!-- VIEW DETALHES -->
            <div id="viewDetalhes" class="view-detalhes">
                <!-- Loading detalhes -->
                <div class="loading-historico" id="loadingDetalhes">
                    <div class="loading-spinner-historico"></div>
                    <p>Carregando detalhes...</p>
                </div>

                <!-- Container dos detalhes (preenchido dinamicamente) -->
                <div id="detalhesContent" style="display: none;">
                    <div class="detalhes-header">
                        <h3 id="detalhesPedidoRef">-</h3>
                        <p id="detalhesPedidoData">-</p>
                    </div>

                    <div class="detalhes-section">
                        <h4>üë§ Informa√ß√µes do Cliente</h4>
                        <div class="info-grid">
                            <div class="info-row">
                                <span class="info-label">Nome Completo</span>
                                <span class="info-value" id="detalhesNome">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Telefone</span>
                                <span class="info-value" id="detalhesTelefone">-</span>
                            </div>
                            <div class="info-row full-width">
                                <span class="info-label">E-mail</span>
                                <span class="info-value" id="detalhesEmail">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="detalhes-section">
                        <h4>üì¶ Itens do Pedido</h4>
                        <table class="itens-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Nome</th>
                                    <th>N√∫mero</th>
                                    <th>Tam. Camiseta</th>
                                    <th>Tam. Cal√ß√£o</th>
                                    <th style="text-align: center;">Qtd</th>
                                </tr>
                            </thead>
                            <tbody id="detalhesItensBody">
                                <!-- Preenchido dinamicamente -->
                            </tbody>
                        </table>
                    </div>

                    <div class="detalhes-actions">
                        <button class="btn-action btn-voltar" onclick="voltarLista()">‚¨ÖÔ∏è Voltar</button>
                        <button class="btn-action btn-imprimir" onclick="imprimirDetalhes()">üñ®Ô∏è Imprimir Pedido</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbwnjScm9c2iHeLjIpqh3NBJEjLnbPNyG9lb2qCvcUjIOh0GJ0lGLbPmKQj4tlvy0R8k/exec';
const SENHA_OFUSCADA = 'MjAyNjA2';

let itens = [];
let itemDuplicadoParaAdicionar = null;
let itemParaDeletar = null;

        // ==================== INICIALIZA√á√ÉO ====================
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
           const temParametroCriptografado = urlParams.has('data');
const temParametrosAntigos = urlParams.has('ref') || urlParams.has('referencia') || urlParams.has('nome') || urlParams.has('tel');

if (temParametroCriptografado || temParametrosAntigos) {
                document.getElementById('mainContainer').style.display = 'block';
                carregarParametrosURL();
            } else {
                document.getElementById('senhaModal').style.display = 'block';
                document.getElementById('senhaAdmin').focus();
                
                document.getElementById('senhaAdmin').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') validarSenha();
                });
            }

            // M√°scara de telefone
            document.getElementById('telefone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                    value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                }
                e.target.value = value;
            });
        });

function validarSenha() {
    const senhaDigitada = document.getElementById('senhaAdmin').value;
    const senhaErro = document.getElementById('senhaErro');
    
    // Comparar senha ofuscada
    if (btoa(senhaDigitada) === SENHA_OFUSCADA) {
        document.getElementById('senhaModal').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';
        senhaErro.textContent = '';
    } else {
        senhaErro.textContent = '‚ùå Senha incorreta! Tente novamente.';
        document.getElementById('senhaAdmin').value = '';
        document.getElementById('senhaAdmin').focus();
        
        const modal = document.querySelector('#senhaModal .modal-content');
        modal.style.animation = 'shake 0.5s';
        setTimeout(() => modal.style.animation = '', 500);
    }
}

        function carregarParametrosURL() {
    const urlParams = new URLSearchParams(window.location.search);
    
    let referencia, nome, telefone, email;
    
    // Tentar carregar do par√¢metro criptografado primeiro
    const dadosCriptografados = urlParams.get('data');
    
    if (dadosCriptografados) {
        try {
            // Decodificar Base64
            const dadosDecodificados = atob(dadosCriptografados);
            const partes = dadosDecodificados.split('|');
            
            referencia = partes[0] || '';
            nome = partes[1] || '';
            telefone = partes[2] || '';
            email = partes[3] || '';
        } catch (error) {
            console.error('Erro ao decodificar link:', error);
            alert('‚ö†Ô∏è Link inv√°lido ou corrompido!');
            return;
        }
    } else {
        // Fallback para par√¢metros antigos (compatibilidade)
        referencia = urlParams.get('ref') || urlParams.get('referencia');
        nome = urlParams.get('nome') || urlParams.get('name');
        telefone = urlParams.get('tel') || urlParams.get('telefone') || urlParams.get('phone');
        email = urlParams.get('email') || urlParams.get('mail');
    }
    
    if (referencia || nome || telefone) {
        const btnGerarLink = document.querySelector('.btn-link');
        const linkResult = document.getElementById('linkResult');
        if (btnGerarLink) btnGerarLink.style.display = 'none';
        if (linkResult) linkResult.style.display = 'none';
    }
    
    if (referencia) {
        document.getElementById('referencia').value = referencia;
        document.getElementById('referencia').readOnly = true;
        document.getElementById('referencia').style.backgroundColor = '#f0f0f0';
    }
    
    if (nome) {
        document.getElementById('nome').value = nome;
        document.getElementById('nome').readOnly = true;
        document.getElementById('nome').style.backgroundColor = '#f0f0f0';
    }
    
    if (telefone) {
        document.getElementById('telefone').value = telefone;
        document.getElementById('telefone').readOnly = true;
        document.getElementById('telefone').style.backgroundColor = '#f0f0f0';
    }
    
    if (email) {
        document.getElementById('email').value = email;
        document.getElementById('email').readOnly = true;
        document.getElementById('email').style.backgroundColor = '#f0f0f0';
    }
}

        // ==================== NAVEGA√á√ÉO ====================
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');

            if (tabName === 'revisar') atualizarRevisao();
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');

            document.querySelectorAll('.accordion-header').forEach(h => {
                h.classList.remove('active');
                h.nextElementSibling.classList.remove('active');
            });

            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // ==================== LINK ====================
       function gerarLink() {
    const referencia = document.getElementById('referencia').value.trim();
    const nome = document.getElementById('nome').value.trim();
    const telefone = document.getElementById('telefone').value.trim();
    const email = document.getElementById('email').value.trim();

    if (!referencia || !nome || !telefone) {
        alert('‚ö†Ô∏è Preencha Refer√™ncia, Nome e Telefone para gerar o link!');
        return;
    }

    // Criar string com dados separados por pipe |
    const dadosParaCriptografar = `${referencia}|${nome}|${telefone.replace(/\D/g, '')}|${email}`;
    
    // Codificar em Base64
    const dadosCriptografados = btoa(dadosParaCriptografar);
    
    const urlAtual = window.location.href.split('?')[0];
    const linkCompleto = `${urlAtual}?data=${dadosCriptografados}`;
    
    document.getElementById('generatedLink').textContent = linkCompleto;
    document.getElementById('linkResult').classList.add('show');
    document.getElementById('linkResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

        function copiarLinkGerado() {
            const link = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(link).then(function() {
                const btn = document.querySelector('.btn-copy-link');
                const textoOriginal = btn.textContent;
                btn.textContent = '‚úÖ Link Copiado!';
                btn.style.background = '#1e7e34';
                setTimeout(function() {
                    btn.textContent = textoOriginal;
                    btn.style.background = '#28a745';
                }, 3000);
            }).catch(function(err) {
                alert('‚ùå Erro ao copiar: ' + err);
            });
        }

        // ==================== ITENS ====================
        function verificarDuplicata(novoItem) {
            for (let i = 0; i < itens.length; i++) {
                const item = itens[i];
                if (item.tipo === novoItem.tipo && item.nome === novoItem.nome && item.numero === novoItem.numero && 
                    item.adicional === novoItem.adicional && item.tamCamiseta === novoItem.tamCamiseta && 
                    item.tamCalcao === novoItem.tamCalcao && item.quantidade === novoItem.quantidade) {
                    return true;
                }
            }
            return false;
        }

        function adicionarItem() {
    const tipo = document.getElementById('novoTipo').value;
    const tamCamiseta = document.getElementById('novoTamCamiseta').value;
    const tamCalcao = document.getElementById('novoTamCalcao').value;
    const quantidade = document.getElementById('novoQuantidade').value;
    
    // Valida√ß√£o de campos obrigat√≥rios
    if (!tipo) {
        alert('‚ö†Ô∏è Selecione o TIPO do item!');
        document.getElementById('novoTipo').focus();
        return;
    }
    
    // Valida√ß√£o: pelo menos UM tamanho deve ser preenchido
    if (!tamCamiseta && !tamCalcao) {
        alert('‚ö†Ô∏è Selecione pelo menos UM TAMANHO (Camiseta ou Cal√ß√£o)!');
        document.getElementById('novoTamCamiseta').focus();
        return;
    }
    
    if (!quantidade || quantidade < 1) {
        alert('‚ö†Ô∏è Informe uma QUANTIDADE v√°lida (m√≠nimo 1)!');
        document.getElementById('novoQuantidade').focus();
        return;
    }

    const novoItem = {
        tipo: tipo,
        nome: document.getElementById('novoNome').value.trim().toUpperCase(),
        numero: document.getElementById('novoNumero').value.trim(),
        adicional: document.getElementById('novoAdicional').value.trim().toUpperCase(),
        tamCamiseta: tamCamiseta,
        tamCalcao: tamCalcao,
        quantidade: quantidade,
        enviado: false
    };

    if (verificarDuplicata(novoItem)) {
        itemDuplicadoParaAdicionar = novoItem;
        mostrarModalDuplicata(novoItem);
        return;
    }

    executarAdicaoItem(novoItem);
}

        function executarAdicaoItem(item) {
            itens.push(item);
            renderizarItens();
            limparFormularioNovo();
            atualizarContador();            
        }

        function limparFormularioNovo() {    
    document.getElementById('novoNome').value = '';
    document.getElementById('novoNumero').value = '';
    document.getElementById('novoAdicional').value = '';
    document.getElementById('novoTamCamiseta').value = '';
    document.getElementById('novoTamCalcao').value = '';
    document.getElementById('novoQuantidade').value = '1';
    
    // Foca no campo Nome
    document.getElementById('novoNome').focus();
}
    
// ==================== Fun√ß√£o renderizarItens() ====================
function renderizarItens() {
    const container = document.getElementById('itemsList');
    
    if (itens.length === 0) {
        container.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px 20px; color: #999;"><div style="font-size: 3em; margin-bottom: 10px;">üì¶</div><p>Nenhum item adicionado ainda</p></div>';
        return;
    }

    container.innerHTML = '';

    itens.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'accordion-item' + (item.enviado ? ' enviado' : '');
        
        // Extrair apenas o nome do tipo (sem o n√∫mero)
        const tipoLimpo = item.tipo.replace(/^\d+\s*-\s*/, '');
        
        const displayNome = item.nome || '(sem nome)';
        const displayNumero = item.numero ? ` | N¬∫ ${item.numero}` : '';
        const displayAdicional = item.adicional ? ` | ${item.adicional}` : '';
        
        // Montar tamanhos
        let displayTamanhos = '';
        if (item.tamCamiseta && item.tamCalcao) {
            displayTamanhos = ` | ${item.tamCamiseta}/${item.tamCalcao}`;
        } else if (item.tamCamiseta) {
            displayTamanhos = ` | Cam: ${item.tamCamiseta}`;
        } else if (item.tamCalcao) {
            displayTamanhos = ` | Cal: ${item.tamCalcao}`;
        }
        
        const displayQuantidade = item.quantidade ? ` | Qtd: ${item.quantidade}` : '';
        const badgeEnviado = item.enviado ? '<span class="badge-enviado">‚úì ENVIADO</span>' : '';
        
        itemDiv.innerHTML = `
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <div><strong>${index + 1}:</strong> ${tipoLimpo} ‚Üí ${displayNome}${displayNumero}${displayAdicional}${displayTamanhos}${displayQuantidade} ${badgeEnviado}</div>
                <span class="accordion-icon">‚ñº</span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <div class="item-edit-grid">
                        <div class="item-edit-field">
                            <label>Tipo</label>
                            <select class="item-tipo" data-index="${index}">
                                <option value="">Selecione</option>
                                ${['1 - Linha', '2 - Goleiro', '3 - Comiss√£o T√©cnica', '4 - Arbitragem', '5 - Torcedor', '6 - Regata', '7 - Tradicional', '8 - Raglan', '9 - Gola V', '10 - Gola Polo'].map(t => `<option value="${t}" ${item.tipo === t ? 'selected' : ''}>${t}</option>`).join('')}
                            </select>
                        </div>
                        <div class="item-edit-field">
                            <label>Quantidade</label>
                            <input type="number" class="item-quantidade" data-index="${index}" value="${item.quantidade}" min="1">
                        </div>
                        <div class="item-edit-field">
                            <label>Nome</label>
                            <input type="text" class="item-nome" data-index="${index}" value="${item.nome}" placeholder="Nome do jogador">
                        </div>
                        <div class="item-edit-field">
                            <label>N√∫mero</label>
                            <input type="text" class="item-numero" data-index="${index}" value="${item.numero}" placeholder="N¬∫">
                        </div>
                        <div class="item-edit-field">
                            <label>Tam. Camiseta</label>
                            <select class="item-tam-camiseta" data-index="${index}">
                                <option value="">Selecione</option>
                                ${gerarOpcoesTamanho(item.tamCamiseta)}
                            </select>
                        </div>
                        <div class="item-edit-field">
                            <label>Tam. Cal√ß√£o</label>
                            <select class="item-tam-calcao" data-index="${index}">
                                <option value="">Selecione</option>
                                ${gerarOpcoesTamanho(item.tamCalcao)}
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-remove" onclick="removerItem(${index})">üóëÔ∏è Remover</button>
                </div>
            </div>
        `;
        container.appendChild(itemDiv);
    });

    adicionarEventListenersEdicao();
}
    
        function adicionarEventListenersEdicao() {
            document.querySelectorAll('.item-tipo').forEach(select => {
                select.addEventListener('change', function() {
                    itens[parseInt(this.dataset.index)].tipo = this.value;
                    atualizarHeaderItem(parseInt(this.dataset.index));
                });
            });

            document.querySelectorAll('.item-nome').forEach(input => {
                input.addEventListener('input', function() {
                    itens[parseInt(this.dataset.index)].nome = this.value.trim().toUpperCase();
                    atualizarHeaderItem(parseInt(this.dataset.index));
                });
            });

            document.querySelectorAll('.item-numero').forEach(input => {
                input.addEventListener('input', function() {
                    itens[parseInt(this.dataset.index)].numero = this.value.trim();
                    atualizarHeaderItem(parseInt(this.dataset.index));
                });
            });

            document.querySelectorAll('.item-adicional').forEach(input => {
                input.addEventListener('input', function() {
                    itens[parseInt(this.dataset.index)].adicional = this.value.trim().toUpperCase();
                });
            });

            document.querySelectorAll('.item-tam-camiseta').forEach(select => {
                select.addEventListener('change', function() {
                    itens[parseInt(this.dataset.index)].tamCamiseta = this.value;
                });
            });

            document.querySelectorAll('.item-tam-calcao').forEach(select => {
                select.addEventListener('change', function() {
                    itens[parseInt(this.dataset.index)].tamCalcao = this.value;
                });
            });

            document.querySelectorAll('.item-quantidade').forEach(input => {
                input.addEventListener('input', function() {
                    itens[parseInt(this.dataset.index)].quantidade = this.value.trim();
                });
            });
        }

// ==================== Fun√ß√£o atualizarHeaderItem() ====================
function atualizarHeaderItem(index) {
    const item = itens[index];
    
    // Extrair apenas o nome do tipo (sem o n√∫mero)
    const tipoLimpo = item.tipo.replace(/^\d+\s*-\s*/, '');
    
    const displayNome = item.nome || '(sem nome)';
    const displayNumero = item.numero ? ` | N¬∫ ${item.numero}` : '';
    const displayAdicional = item.adicional ? ` | ${item.adicional}` : '';
    
    // Montar tamanhos
    let displayTamanhos = '';
    if (item.tamCamiseta && item.tamCalcao) {
        displayTamanhos = ` | ${item.tamCamiseta}/${item.tamCalcao}`;
    } else if (item.tamCamiseta) {
        displayTamanhos = ` | Cam: ${item.tamCamiseta}`;
    } else if (item.tamCalcao) {
        displayTamanhos = ` | Cal: ${item.tamCalcao}`;
    }
    
    const displayQuantidade = item.quantidade ? ` | Qtd: ${item.quantidade}` : '';
    const badgeEnviado = item.enviado ? '<span class="badge-enviado">‚úì ENVIADO</span>' : '';
    
    const accordionItems = document.querySelectorAll('.accordion-item');
    if (accordionItems[index]) {
        const header = accordionItems[index].querySelector('.accordion-header > div');
        if (header) {
            header.innerHTML = `<strong>${index + 1}:</strong> ${tipoLimpo} ‚Üí ${displayNome}${displayNumero}${displayAdicional}${displayTamanhos}${displayQuantidade} ${badgeEnviado}`;
        }
    }
}
    
        function gerarOpcoesTamanho(valorSelecionado) {
            const tamanhos = ['PP', 'P', 'M', 'G', 'GG', 'G1', 'G2', 'G3', 'G4', 'G5', 'BLPP', 'BLP', 'BLM', 'BLG', 'BLGG', 'BLG1', 'BLG2', 'BLG3', 'BLG4', 'BLG5', '1A', '2A', '4A', '6A', '8A', '10A', '12A'];
            return tamanhos.map(t => `<option value="${t}" ${t === valorSelecionado ? 'selected' : ''}>${t}</option>`).join('');
        }

        function atualizarContador() {
            document.getElementById('counterBadge').textContent = itens.length;
        }

        function removerItem(index) {
            const item = itens[index];
            
            if (item.enviado) {
                itemParaDeletar = index;
                
                document.getElementById('deleteMessage').innerHTML = 
                    `<strong style="color: #dc3545;">‚ö†Ô∏è Esta linha J√Å FOI ENVIADA para a planilha!</strong><br><br>` +
                    `<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 15px 0;">` +
                    `<strong>Item a deletar:</strong><br>` +
                    `üìã Tipo: <strong>${item.tipo}</strong><br>` +
                    `üë§ Nome: <strong>${item.nome}</strong><br>` +
                    `üî¢ N√∫mero: <strong>${item.numero}</strong>` +
                    `</div>` +
                    `Deseja <strong style="color: #dc3545;">DELETAR</strong> este item da planilha?`;
                
                document.getElementById('deleteModal').style.display = 'block';
            } else {
                itens.splice(index, 1);
                renderizarItens();
                atualizarContador();
            }
        }    

// ==================== Fun√ß√£o atualizarRevisao() ====================
function atualizarRevisao() {
    document.getElementById('reviewRef').textContent = document.getElementById('referencia').value || '-';
    document.getElementById('reviewNome').textContent = document.getElementById('nome').value || '-';
    document.getElementById('reviewTel').textContent = document.getElementById('telefone').value || '-';
    document.getElementById('reviewEmail').textContent = document.getElementById('email').value || '-';
    document.getElementById('reviewTotal').textContent = itens.length;
    
    const lista = document.getElementById('reviewList');
    lista.innerHTML = '';
    
    if (itens.length === 0) {
        lista.innerHTML = '<li style="color: #999;">Nenhum item adicionado</li>';
    } else {
        itens.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'item-review';
            
            // Extrair apenas o nome do tipo (sem o n√∫mero)
            const tipoLimpo = item.tipo.replace(/^\d+\s*-\s*/, '');
            
            // Montar tamanhos
            let tamanhos = '';
            if (item.tamCamiseta && item.tamCalcao) {
                tamanhos = `${item.tamCamiseta}/${item.tamCalcao}`;
            } else if (item.tamCamiseta) {
                tamanhos = `Cam: ${item.tamCamiseta}`;
            } else if (item.tamCalcao) {
                tamanhos = `Cal: ${item.tamCalcao}`;
            } else {
                tamanhos = '-';
            }
            
            const numero = item.numero ? `N¬∫ ${item.numero}` : '-';
            const adicional = item.adicional ? ` | ${item.adicional}` : '';
            
            li.innerHTML = `
                <div class="item-header">Item ${index + 1} ‚Üí ${tipoLimpo}</div>
                <div class="item-details">üë§ ${item.nome || '(sem nome)'} | ${numero} | ${tamanhos} | Qtd: ${item.quantidade || '1'}${adicional}</div>
            `;
            lista.appendChild(li);
        });
    }
}
    
        // ==================== ENVIAR PEDIDO ====================
        function enviarPedido() {
            const referencia = document.getElementById('referencia').value;
            const nome = document.getElementById('nome').value;
            const telefone = document.getElementById('telefone').value;
            const email = document.getElementById('email').value;

            if (!referencia || !nome || !telefone) {
                alert('‚ö†Ô∏è Preencha Refer√™ncia, Nome e Telefone!');
                return;
            }

            const itensParaEnviar = itens.filter(item => !item.enviado);

            if (itensParaEnviar.length === 0) {
                alert('‚ö†Ô∏è Nenhum item novo para enviar!\n\nTodos os itens j√° foram enviados ou n√£o h√° itens preenchidos.');
                return;
            }

            const formData = {
                referencia: referencia,
                nome: nome,
                telefone: telefone,
                email: email,
                itens: itensParaEnviar
            };

            const btnSubmit = document.querySelector('.btn-primary');
            const textoOriginal = btnSubmit.textContent;
            btnSubmit.disabled = true;
            btnSubmit.textContent = '‚è≥ Enviando...';

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => {
                itens.forEach(item => {
                    if (!item.enviado) item.enviado = true;
                });

                renderizarItens();
                
                document.getElementById('modalMessage').innerHTML = 
                    `<strong>üìã Refer√™ncia:</strong> ${referencia}<br>` +
                    `<strong>üë§ Cliente:</strong> ${nome}<br>` +
                    `<strong>üì¶ Itens Enviados:</strong> ${itensParaEnviar.length}<br><br>` +
                    `<em>‚úÖ Planilha atualizada com sucesso!</em>`;
                document.getElementById('successModal').style.display = 'block';
            })
            .catch(error => {
                alert('‚ùå Erro: ' + error.message);
                console.error('Erro:', error);
            })
            .finally(() => {
                btnSubmit.disabled = false;
                btnSubmit.textContent = textoOriginal;
            });
        }
    
        // ==================== IMPRESS√ÉO ====================
        function imprimirPedido() {
            // Atualizar data/hora da impress√£o
            const agora = new Date();
            const dataFormatada = agora.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('printDate').textContent = dataFormatada;
            
            // Abrir di√°logo de impress√£o
            window.print();
        }

        // ==================== MODAIS ====================
        function mostrarModalDuplicata(item) {
            const detalhesHTML = `
                <div><strong>Tipo:</strong> ${item.tipo || '(vazio)'}</div>
                <div><strong>Nome:</strong> ${item.nome || '(vazio)'}</div>
                <div><strong>N√∫mero:</strong> ${item.numero || '(vazio)'}</div>
                <div><strong>Adicional:</strong> ${item.adicional || '(vazio)'}</div>
                <div><strong>Tam. Camiseta:</strong> ${item.tamCamiseta || '(vazio)'}</div>
                <div><strong>Tam. Cal√ß√£o:</strong> ${item.tamCalcao || '(vazio)'}</div>
                <div><strong>Quantidade:</strong> ${item.quantidade || '1'}</div>
            `;
            
            document.getElementById('duplicataDetalhes').innerHTML = detalhesHTML;
            document.getElementById('duplicataModal').style.display = 'block';
        }

        document.getElementById('btnConfirmarDuplicata').addEventListener('click', function() {
            document.getElementById('duplicataModal').style.display = 'none';
            executarAdicaoItem(itemDuplicadoParaAdicionar);
            itemDuplicadoParaAdicionar = null;
        });

        document.getElementById('btnCancelarDuplicata').addEventListener('click', function() {
            document.getElementById('duplicataModal').style.display = 'none';
            itemDuplicadoParaAdicionar = null;
        });

        document.getElementById('btnConfirmarDelete').addEventListener('click', function() {
            if (itemParaDeletar === null) return;
            
            const item = itens[itemParaDeletar];
            document.getElementById('deleteModal').style.display = 'none';
            
            const dadosParaDeletar = {
                action: 'delete',
                referencia: document.getElementById('referencia').value,
                tipo: item.tipo,
                nome: item.nome,
                numero: item.numero,
                tamCamiseta: item.tamCamiseta,
                tamCalcao: item.tamCalcao
            };
            
            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosParaDeletar)
            })
            .then(() => {
                itens.splice(itemParaDeletar, 1);
                renderizarItens();
                atualizarContador();
                
                const modalMsg = document.getElementById('modalMessage');
                modalMsg.innerHTML = 
                    `<strong style="color: #28a745;">‚úÖ Item Deletado com Sucesso!</strong><br><br>` +
                    `O item foi removido do formul√°rio e da planilha.<br>` +
                    `O resumo foi atualizado automaticamente.`;
                document.getElementById('successModal').style.display = 'block';
            })
            .catch(error => {
                alert('‚ùå Erro ao deletar da planilha: ' + error.message);
                console.error('Erro:', error);
            });
            
            itemParaDeletar = null;
        });

        document.getElementById('btnCancelarDelete').addEventListener('click', function() {
            document.getElementById('deleteModal').style.display = 'none';
            itemParaDeletar = null;
        });

        document.getElementById('btnFecharModal').addEventListener('click', function() {
            document.getElementById('successModal').style.display = 'none';
        });

        window.onclick = function(event) {
            const successModal = document.getElementById('successModal');
            const deleteModal = document.getElementById('deleteModal');
            const duplicataModal = document.getElementById('duplicataModal');
            
            if (event.target == successModal) successModal.style.display = 'none';
            if (event.target == deleteModal) {
                deleteModal.style.display = 'none';
                itemParaDeletar = null;
            }
            if (event.target == duplicataModal) {
                duplicataModal.style.display = 'none';
                itemDuplicadoParaAdicionar = null;
            }
        }
// Cache local para evitar m√∫ltiplas chamadas
let cachePedidosHistorico = null;

// ==================== ABRIR HIST√ìRICO ====================
// Cache local para evitar m√∫ltiplas chamadas
let cachePedidosHistorico = null;

// ==================== ABRIR HIST√ìRICO ====================
function abrirHistorico() {
    const modal = document.getElementById('modalHistorico');
    modal.style.display = 'block';
    voltarLista();
    
    // Se j√° tem cache, usar
    if (cachePedidosHistorico !== null) {
        preencherListaPedidos(cachePedidosHistorico);
        return;
    }
    
    // Mostrar loading
    document.getElementById('loadingLista').style.display = 'block';
    document.getElementById('cardsContainer').innerHTML = '';
    document.getElementById('emptyState').style.display = 'none';
    
    // ‚úÖ USAR JSONP COM TIMEOUT E RETRY
    const callbackName = 'jsonpCallback_' + Date.now();
    let scriptCarregado = false;
    let timeoutId;
    
    window[callbackName] = function(pedidos) {
        scriptCarregado = true;
        clearTimeout(timeoutId);
        
        console.log('‚úÖ Pedidos recebidos via JSONP:', pedidos);
        
        cachePedidosHistorico = pedidos;
        preencherListaPedidos(pedidos);
        
        // Limpar callback global
        delete window[callbackName];
        
        // Remover script tag
        const script = document.getElementById(callbackName);
        if (script) script.remove();
    };
    
    // ‚úÖ TIMEOUT DE 10 SEGUNDOS
    timeoutId = setTimeout(function() {
        if (!scriptCarregado) {
            document.getElementById('loadingLista').style.display = 'none';
            console.error('‚ùå Timeout ao carregar hist√≥rico (10s)');
            alert('‚è±Ô∏è Tempo esgotado ao carregar hist√≥rico.\n\nTente novamente ou verifique sua conex√£o.');
            
            delete window[callbackName];
            const script = document.getElementById(callbackName);
            if (script) script.remove();
            
            fecharHistorico();
        }
    }, 10000); // 10 segundos
    
    // Criar script tag para JSONP
    const script = document.createElement('script');
    script.id = callbackName;
    script.type = 'text/javascript';
    script.async = true;
    
    // ‚úÖ ADICIONAR CACHE BUSTER para Chrome
    const cacheBuster = '&_=' + Date.now();
    script.src = scriptURL + '?action=buscarPedidos&callback=' + callbackName + cacheBuster;
    
    script.onerror = function(e) {
        clearTimeout(timeoutId);
        document.getElementById('loadingLista').style.display = 'none';
        
        console.error('‚ùå Erro ao carregar script JSONP:', e);
        console.error('URL tentada:', script.src);
        
        alert('‚ùå Erro ao carregar hist√≥rico.\n\nVerifique:\n1. Conex√£o com internet\n2. URL do script est√° correta\n3. Console do navegador (F12) para mais detalhes');
        
        delete window[callbackName];
        fecharHistorico();
    };
    
    console.log('üì° Carregando JSONP:', script.src);
    document.body.appendChild(script);
}
    
// ==================== FECHAR HIST√ìRICO ====================
function fecharHistorico() {
    const modal = document.getElementById('modalHistorico');
    modal.style.display = 'none'; // ‚úÖ Usar .style.display ao inv√©s de .classList
    voltarLista();
}
    
// ==================== VOLTAR PARA LISTA ====================
function voltarLista() {
    document.getElementById('viewLista').style.display = 'block';
    document.getElementById('viewDetalhes').style.display = 'none';
    document.getElementById('buscaArea').style.display = 'block';
    document.getElementById('modalTitulo').textContent = 'üìä Hist√≥rico de Pedidos';
}

// ==================== PREENCHER LISTA DE PEDIDOS ====================
function preencherListaPedidos(pedidos) {
    document.getElementById('loadingLista').style.display = 'none';
    
    const container = document.getElementById('cardsContainer');
    container.innerHTML = '';
    
    if (!pedidos || pedidos.length === 0) {
        document.getElementById('emptyState').style.display = 'block';
        return;
    }
    
    document.getElementById('emptyState').style.display = 'none';
    
    // Criar card para cada pedido
    pedidos.forEach(function(pedido) {
        const card = document.createElement('div');
        card.className = 'pedido-card';
        card.dataset.referencia = pedido.referencia;
        card.dataset.nome = pedido.nome;
        card.dataset.telefone = pedido.telefone;
        
        card.innerHTML = `
            <div class="pedido-header">
                <div class="pedido-ref">${pedido.referencia}</div>
                <div class="pedido-data">${pedido.data}</div>
            </div>
            <div class="pedido-info">
                <div class="pedido-info-item">
                    <span class="pedido-info-label">Cliente:</span>
                    <span>${pedido.nome}</span>
                </div>
                <div class="pedido-info-item">
                    <span class="pedido-info-label">Telefone:</span>
                    <span>${pedido.telefone}</span>
                </div>
                <div class="pedido-info-item">
                    <span class="pedido-info-label">E-mail:</span>
                    <span>${pedido.email || '-'}</span>
                </div>
                <div class="pedido-info-item">
                    <span class="pedido-info-label">Itens:</span>
                    <span>${pedido.totalItens} unidades</span>
                </div>
            </div>
            <div class="pedido-actions">
                <button class="btn-action btn-ver" onclick="verDetalhes('${pedido.referencia}')">üëÅÔ∏è Ver Detalhes</button>
                <button class="btn-action btn-imprimir" onclick="imprimirPedidoHistorico('${pedido.referencia}')">üñ®Ô∏è Reimprimir</button>
            </div>
        `;
        
        container.appendChild(card);
    });
}

// ==================== BUSCAR PEDIDOS LOCALMENTE (FILTRO CLIENT-SIDE) ====================
function buscarPedidosLocal() {
    const termo = document.getElementById('searchInput').value.toLowerCase();
    const cards = document.querySelectorAll('.pedido-card');
    let encontrados = 0;
    
    cards.forEach(function(card) {
        const texto = card.textContent.toLowerCase();
        if (texto.includes(termo)) {
            card.style.display = 'block';
            encontrados++;
        } else {
            card.style.display = 'none';
        }
    });
    
    // Mostrar empty state se n√£o encontrou nada
    if (encontrados === 0 && termo !== '') {
        document.getElementById('emptyState').style.display = 'block';
        const emptyP = document.getElementById('emptyState').querySelectorAll('p')[0];
        if (emptyP) emptyP.textContent = 'Nenhum pedido encontrado com "' + termo + '"';
    } else {
        document.getElementById('emptyState').style.display = 'none';
    }
}

// ==================== VER DETALHES DO PEDIDO ====================
function verDetalhes(referencia) {
    // Trocar para view de detalhes
    document.getElementById('viewLista').style.display = 'none';
    document.getElementById('viewDetalhes').style.display = 'block';
    document.getElementById('buscaArea').style.display = 'none';
    document.getElementById('modalTitulo').textContent = 'üìÑ Detalhes do Pedido';
    
    // Mostrar loading
    document.getElementById('loadingDetalhes').style.display = 'block';
    document.getElementById('detalhesContent').style.display = 'none';
    
    // ‚úÖ USAR JSONP COM TIMEOUT
    const callbackName = 'jsonpDetalhes_' + Date.now();
    let scriptCarregado = false;
    let timeoutId;
    
    window[callbackName] = function(dados) {
        scriptCarregado = true;
        clearTimeout(timeoutId);
        
        console.log('‚úÖ Detalhes recebidos via JSONP:', dados);
        
        preencherDetalhesPedido(dados);
        
        // Limpar
        delete window[callbackName];
        const script = document.getElementById(callbackName);
        if (script) script.remove();
    };
    
    // Timeout de 10 segundos
    timeoutId = setTimeout(function() {
        if (!scriptCarregado) {
            document.getElementById('loadingDetalhes').style.display = 'none';
            console.error('‚ùå Timeout ao carregar detalhes');
            alert('‚è±Ô∏è Tempo esgotado ao carregar detalhes.');
            voltarLista();
            delete window[callbackName];
        }
    }, 10000);
    
    const script = document.createElement('script');
    script.id = callbackName;
    script.type = 'text/javascript';
    script.async = true;
    
    // Cache buster para Chrome
    const cacheBuster = '&_=' + Date.now();
    script.src = scriptURL + '?action=buscarDetalhes&referencia=' + encodeURIComponent(referencia) + '&callback=' + callbackName + cacheBuster;
    
    script.onerror = function() {
        clearTimeout(timeoutId);
        document.getElementById('loadingDetalhes').style.display = 'none';
        console.error('‚ùå Erro ao carregar detalhes');
        alert('‚ùå Erro ao carregar detalhes: ' + referencia);
        voltarLista();
        delete window[callbackName];
    };
    
    console.log('üì° Carregando detalhes:', script.src);
    document.body.appendChild(script);
}
    
// ==================== PREENCHER DETALHES DO PEDIDO ====================
function preencherDetalhesPedido(dados) {
    document.getElementById('loadingDetalhes').style.display = 'none';
    document.getElementById('detalhesContent').style.display = 'block';
    
    // Preencher cabe√ßalho
    document.getElementById('detalhesPedidoRef').textContent = dados.referencia;
    document.getElementById('detalhesPedidoData').textContent = 'Criado em ' + dados.data;
    
    // Preencher dados do cliente
    document.getElementById('detalhesNome').textContent = dados.nome;
    document.getElementById('detalhesTelefone').textContent = dados.telefone;
    document.getElementById('detalhesEmail').textContent = dados.email || '-';
    
    // Preencher tabela de itens
    const tbody = document.getElementById('detalhesItensBody');
    tbody.innerHTML = '';
    
    if (!dados.itens || dados.itens.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="6" style="text-align: center; color: #999;">Nenhum item encontrado</td>';
        tbody.appendChild(tr);
        return;
    }
    
    dados.itens.forEach(function(item) {
        // Extrair apenas o nome do tipo (sem o n√∫mero)
        const tipoLimpo = item.tipo.replace(/^\d+\s*-\s*/, '');
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="item-tipo">${tipoLimpo}</td>
            <td>${item.nome || '-'}</td>
            <td style="text-align: center;">${item.numero || '-'}</td>
            <td><span class="item-tamanho">${item.tamCamiseta || '-'}</span></td>
            <td><span class="item-tamanho">${item.tamCalcao || '-'}</span></td>
            <td style="text-align: center;">${item.quantidade || 1}</td>
        `;
        tbody.appendChild(tr);
    });
}

// ==================== IMPRIMIR PEDIDO DO HIST√ìRICO ====================
function imprimirPedidoHistorico(referencia) {
    alert('üñ®Ô∏è Fun√ß√£o de impress√£o ser√° implementada!\n\nRefer√™ncia: ' + referencia);
    // TODO: Implementar impress√£o espec√≠fica
}

// ==================== IMPRIMIR DETALHES (quando est√° na view de detalhes) ====================
function imprimirDetalhes() {
    alert('üñ®Ô∏è Fun√ß√£o de impress√£o ser√° implementada!');
    // TODO: Implementar impress√£o da view de detalhes
}

// ==================== FECHAR MODAL AO CLICAR FORA ====================
// Modificar o window.onclick existente para incluir modal hist√≥rico
var windowOnClickOriginal = window.onclick;
window.onclick = function(event) {
    // Chamar fun√ß√£o original se existir
    if (windowOnClickOriginal) {
        windowOnClickOriginal(event);
    }
    
    // Adicionar comportamento do modal hist√≥rico
    const modalHistorico = document.getElementById('modalHistorico');
    if (event.target === modalHistorico) {
        fecharHistorico();
    }
}
    </script>
</body>
</html>
